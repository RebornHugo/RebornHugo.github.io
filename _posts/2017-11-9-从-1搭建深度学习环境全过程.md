---
title: 从-1开始搭建深度学习环境
categories:
 - DeepLearning
tag:
 - Geek
---

额，记录hh同学主板烧掉之后心酸的日子....

# 从-1开始

为什么是从-1开始呢？事情是这样的。某天晚上我用scrapy爬了一个不记得的贴吧的帖子，睡前照常输入命令`sudo systemctl hibernate`来休眠，我懒不喜欢关机。但第二天发现点不亮了，插电源没用，拆了又装上，也是徒劳。第三天去送修，宏碁官方代理点告诉我主板坏了（和我推测的一样），而且主板过保4个月，换新要3800块！！！~~你怎么不去抢钱啊！~~后来我思索了一下，决定自己攒一台主机。

# 捡垃圾

由于来大学我已经买了两台笔记本了...极度败家的我不敢再乱花钱了，于是便有了接下来的捡垃圾之旅。

由于工作学习的需要，我必须要上16g的内存和1060 6g以上的gpu。我选择了耕升烈风和十铨火神×2，双通道。剩下的则是能扣则扣了。Lenovo的sl700 240g的ssd~~（MLC的固态都是垃圾，希望大家引以为戒）~~，散片intel的7500（传说中的智商检测U），msi的b250m迫击炮，买主板送的酷冷至尊的散热扇，航嘉450w的电源，还有一个巨丑的机箱......基本够用了，如果再多1000的预算的话，我会上nvme的固态和8400的主板套。ryzen系列的话我担心和linux不兼容，所以没有上农企的车。e3洋垃圾我也考虑过，但是由于没有核显和部分指令集，外加不会搭服务器集群，也放弃了。想到实验室还有7700k和一块1080ti，宿舍里也不用不太到那么高的配置，能跑点主流的model就满足了。

推荐大家买牙膏厂的cpu都上淘宝散片~~据说不对着cpu撒尿都翻不了车~~，毕竟一年质保和三年质保+盒子差了300块，没必要。别的7大部件尽量上狗东自营，售后有保障。

![订单](/assets/images/post_images/从-1打造深度学习环境/订单1.png)

![订单](/assets/images/post_images/从-1打造深度学习环境/订单2.png)

总结一下，买电脑这事儿就像旅游，有钱人就上顶配外星人、败家之眼顶配或者我们实验室顶配**omen** 880这些，质量好售后更好，好比旅游时嫌麻烦便多花点钱上最贵服务。亦或是自己研究路线、买票、找食宿，就和现在的我一样选部件来组装，好处是可定制性强，而且会便宜一些。最不推荐的是整机，看上去便宜，但很容易上烈士墙。就像贪图便宜上廉价旅游团，换来的只是被导游无限的推销。

# 组装机器

由于组装过程没有拍什么图，所以只能靠回忆脑补。

## 安装cpu到主板上

注意cpu上有一个小的三角，要和主板上的对应，然后无脑盖上盖子即可，不要弄坏了主板上的针脚。

![cpu](/assets/images/post_images/从-1打造深度学习环境/cpu.jpg)

> 散装cpu上的封条不用撕掉，撕了就没质保了（虽然并没有什么用）  

然后加一些硅脂再cpu表面。

## 装cpu风扇

这是此次装机中最困难的一部分，买主板送的原价50的酷冷至尊的散热扇，真的很难装。我们先把底座和散热扇装在一起，再将其放在主板上。后面大力出奇迹，三个同学一起强行把固定底座的四根小棍子插进了主板。

![cpu](/assets/images/post_images/从-1打造深度学习环境/cpu3.jpg)

> 两位机友

## 装内存条

装在靠近cpu的1号和3号插槽，可以上双通道。这里看上去散热扇好像是对着内存条吹的，其实不是，散热扇是抽风吸热，从后面的铜片出散热。

![cpu](/assets/images/post_images/从-1打造深度学习环境/cpu2.jpg)

## 走几根线塞进机箱

我的机箱太小没法走背线，故很丑。接通总电源线，cpu线，cpu fan线。然后**先装上买主板配赠的挡板**，再把**电源**和**主板**塞进机箱，要开始无限拧螺丝了。

记住对硬盘、显卡这些部件，需要接**电源线**和**数据线**。

固定好电源和主板后接上**usb**，**hd audio**的接口。尝试放显卡进机箱，但发现需要拆掉机箱外的两条铁皮，用来暴露出**HDMI**和**DVI**的接口，于是先撕铁皮。

![塞机箱](/assets/images/post_images/从-1打造深度学习环境/塞机箱.jpg)

## 装硬盘

还是没有先装显卡，是因为我发现我的小机箱如果先装显卡会很难再装上去硬盘。我的固态是sata3接口的，后悔没有上NVME。从一堆电源线里找出一根线给硬盘供电，买主板时送了两根sata3的线。一头接主板上sata3的接口，另一头借硬盘的。用两颗螺丝将硬盘固定在机箱上。同理，可以装sata3接口的另一个西数机械硬盘，来自主板坏了的笔记本VN7.....反正我后来还是嫌机械硬盘声音大把它拆了233

## 装显卡

显卡插在主板上，接上电源线，拧两颗螺丝就完事了。

![显卡](/assets/images/post_images/从-1打造深度学习环境/显卡.jpg)

## OVER

插上显示器，装机结束。下图为灵魂走线...盖上透明侧窗，装机结束。

![over](/assets/images/post_images/从-1打造深度学习环境/over.jpg)

由于我的机械硬盘里有之前的win10和ubuntu，所以我开机直接进去了。但是我不会migrate ubuntu到ssd，修改grub有点复杂。转念一想，反正电脑都重拼了一台，重刷个系统多大点儿事啊，于是便踏入了重装系统的坑。

# 刷机

淘汰下来的hdd我放在了2.5寸硬盘转接盒，拿来做移动硬盘了。这是这四个月第三次刷ubuntu...上次重刷还是因为把驱动玩坏了，想不到这么快主板又坏了..

## 系统选择

暂时用不到win，我选择了ubuntu 16.04LTS。最近17.10已经出来了，还是Genome的桌面。但想到暑假坑爹的17.04，各种意想不到的bug以及屈指可数的解决方案，我还是滚回了LTS版本。除非等到18.04LTS，不然绝不换系统。做deep learning不像搞开发，一个稳定的系统极其重要。像tensorflow keras这些库默认的都是ubuntu系统。以14.04和16.04为佳。

## 做启动盘

这一步应该是最简单的。下个ultraso，ubuntu官网的最新版本，直接无脑刷到u盘就可以了，连格式化都不需要。我这里用的启动盘是16g ubs 2.0的闪迪**CZ48**，其实用8g的完全ok。

插到电脑上，进BIOS，设置启动项ubuntu放在首位，按照提示一步一步来就行。

稍微要注意点的地方是磁盘分区，我习惯不好，分了16g的swap区后（因为我的ram也是16g），剩下全分给了/ 了，大家可以自由发挥。

细节不记得了，没什么难度，记得时区选上海，语言一定要English，不然以后路径名全是坑233333，安装系统时好像还会问要不要额外安装系统需要的东西，千万要点拒绝！

![装系统](/assets/images/post_images/从-1打造深度学习环境/装系统.jpg)

## 日常软件的安装

其实这才是我最想写的部分，我经常会因为各种原因重刷系统，后来总要重装一些软件或驱动，但又记不全导致后来又很多坑，所以干脆现在先记录下来，一来便于我后期使用，二来也给阅读我的blog的人提供一些经验。

### 删垃圾

刷完机之后，第一件事情是删掉没有用的垃圾，比如amazon，libreoffice（用过了才知道有多么垃圾）

`sudo apt remove libreoffice-common`

`sudo apt remove unity-webapps-common`  

### 换源

推荐USTC的源，因为被Tsinghua坑过..

`sudo gedit  /etc/apt/sources.list `

换成

```shell
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.ustc.edu.cn/ubuntu/ xenial main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ xenial main main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ xenial-security main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ xenial-security main restricted universe multiverse
 
# 预发布软件源，不建议启用
# deb https://mirrors.ustc.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse
# deb-src https://mirrors.ustc.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse
```

换完源后`sudo apt update`

### Over the GFW

`sudo apt install python-pip`

`pip install --upgrade pip `

`pip install shadowsocks`

`pip install genpac`

` pip install --upgrade genpac`

然后去home下mkdir一个shadowsocks文件夹并cd进去，gedit一个ss.json，里面写上服务器的配置，现在就可以`sslocal -c ss.json`了

`genpac -p "SOCKS5 127.0.0.1:1080" --gfwlist-proxy="SOCKS5 127.0.0.1:1080" --gfwlist-url=<https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt> --output="autoproxy.pac"`

生成一个pac文件，在proxy里设置url为此文件。![proxy](/assets/images/post_images/从-1打造深度学习环境/proxy.png)

### browser配置

先安装chrome

`sudo wget http://www.linuxidc.com/files/repo/google-chrome.list -P /etc/apt/sources.list.d/`

`wget -q -O - https://dl.google.com/linux/linux_signing_key.pub  | sudo apt-key add -`

`sudo apt-get update`

`sudo apt-get install google-chrome-stable`

如果一切顺利的话，这时候搜索chrome就有了，lock到launch栏方便到时候使用。

如果ss也顺利配置成功的话，现在就可以登录google account了。对我而言，这是最关键的一步，因为我的生产环境有极大一部分依赖于能跨越长城的chrome，以及一个可以同步书签和app的google account。

![chrome](/assets/images/post_images/从-1打造深度学习环境/chrome.png)

